name: CI

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        version: [hterm-1.87]

    steps:
      - name: clone libapps:${{ matrix.version }}
        run: git clone -b ${{ matrix.version }} https://chromium.googlesource.com/apps/libapps
      - name: Setup Python environment
        uses: actions/setup-python@v1.1.1
      - name: build dist
        run: |
          cd libapps
          ./hterm/bin/mkdist
      - name: apply patch
        run: |
          mkdir dist
          cd libapps/hterm/dist/js
          sed -i 's/var hterm = {};/export const hterm = {};/;s/const lib = {};/export const lib = {};/' hterm_all.js
          cp hterm_all.js ~/dist
      - name: Upload artifact
        uses: actions/upload-artifact@v1.0.0
        with:
          name: dist
          path: dist
      - name: GitHub Pages
        uses: crazy-max/ghaction-github-pages@v1.2.5
        with:
          target_branch: ${{ matrix.version }}
          build_dir: dist
          commit_message: "deploy"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
